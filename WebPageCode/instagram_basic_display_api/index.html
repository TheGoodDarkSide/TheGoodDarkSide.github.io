<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Basic Display API</title>
</head>
<body>
    <h1>Instagram Basic Display API</h1>
    <hr />
    <script src="instagram_basic_display_api.js"></script>
    <script>
        // Définition des paramètres d'accès
        const accessToken = 'ACCESS-TOKEN';
        const params = {
            get_code: (new URLSearchParams(window.location.search)).get('code') || '',
            access_token: accessToken,
            user_id: 'USER-ID'
        };

        // Instanciation de l'objet InstagramBasicDisplayAPI
        const ig = new InstagramBasicDisplayAPI(params);

        // Vérification de l'accès utilisateur
        if (ig.hasUserAccessToken) {
            document.write('<h4>IG Info</h4><hr />');
            
            // Récupération des informations utilisateur
            const user = ig.getUser();
            document.write('<pre>' + JSON.stringify(user, null, 2) + '</pre>');
            document.write('<h1>Username: ' + user.username + '</h1>');
            document.write('<h2>IG ID: ' + user.id + '</h2>');
            document.write('<h3>Media Count: ' + user.media_count + '</h3>');
            document.write('<h4>Account Type: ' + user.account_type + '</h4>');
            document.write('<hr />');

            // Récupération du post en vedette
            const highlightedPostId = 'MEDIA-ID';
            document.write('<h3>Highlighted Post</h3>');
            document.write('<div>Media ID: ' + highlightedPostId + '</div>');
            
            const media = ig.getMedia(highlightedPostId);
            const mediaChildren = ig.getMediaChildren(highlightedPostId);

            document.write('<h4>Raw Data</h4>');
            document.write('<textarea style="width:100%;height:400px;">Media ' + JSON.stringify(media, null, 2) + 'Children ' + JSON.stringify(mediaChildren, null, 2) + '</textarea>');
            
            document.write('<div style="margin-bottom:20px;margin-top:20px;border:3px solid #333">');
            mediaChildren.data.forEach(child => {
                if (child.media_type === 'IMAGE') {
                    document.write('<img style="height:320px" src="' + child.media_url + '" />');
                } else {
                    document.write('<video height="240" width="320" controls>');
                    document.write('<source src="' + child.media_url + '">');
                    document.write('</video>');
                }
            });
            document.write('<div><b>Caption: ' + media.caption + '</b></div>');
            document.write('<div>Posted by: ' + media.username + ' at ' + media.timestamp + '</div>');
            document.write('<div>Link: <a href="' + media.permalink + '" target="_blank">' + media.permalink + '</a></div>');
            document.write('<div>ID: ' + media.id + '</div>');
            document.write('<div>Media Type: ' + media.media_type + '</div>');
            document.write('</div>');

            // Récupération des médias de l'utilisateur
            const usersMedia = ig.getUsersMedia();
            document.write('<h3>Users Media Page 1 (' + usersMedia.data.length + ')</h3>');
            document.write('<h4>Raw Data</h4>');
            document.write('<textarea style="width:100%;height:400px;">' + JSON.stringify(usersMedia, null, 2) + '</textarea>');
            
            document.write('<h4>Posts</h4>');
            document.write('<ul style="list-style: none;margin:0px;padding:0px;">');
            usersMedia.data.forEach(post => {
                document.write('<li style="margin-bottom:20px;border:3px solid #333">');
                if (post.media_type === 'IMAGE' || post.media_type === 'CAROUSEL_ALBUM') {
                    document.write('<img style="height:320px" src="' + post.media_url + '" />');
                } else {
                    document.write('<video height="240" width="320" controls>');
                    document.write('<source src="' + post.media_url + '">');
                    document.write('</video>');
                }
                document.write('<div><b>Caption: ' + post.caption + '</b></div>');
                document.write('<div>ID: ' + post.id + '</div>');
                document.write('<div>Media Type: ' + post.media_type + '</div>');
                document.write('<div>Media URL: ' + post.media_url + '</div>');
                document.write('</li>');
            });
            document.write('</ul>');

            // Récupération de la page suivante de médias de l'utilisateur
            const usersMediaNext = ig.getPaging(usersMedia.paging.next);
            document.write('<h3>Users Media Page 2 (' + usersMediaNext.data.length + ')</h3>');
            document.write('<h4>Raw Data</h4>');
            document.write('<textarea style="width:100%;height:400px;">' + JSON.stringify(usersMediaNext, null, 2) + '</textarea>');
            
            document.write('<h4>Posts</h4>');
            document.write('<ul style="list-style: none;margin:0px;padding:0px;">');
            usersMediaNext.data.forEach(post => {
                document.write('<li style="margin-bottom:20px;border:3px solid #333">');
                if (post.media_type === 'IMAGE' || post.media_type === 'CAROUSEL_ALBUM') {
                    document.write('<img style="height:320px" src="' + post.media_url + '" />');
                } else {
                    document.write('<video height="240" width="320" controls>');
                    document.write('<source src="' + post.media_url + '">');
                    document.write('</video>');
                }
                document.write('<div><b>Caption: ' + post.caption + '</b></div>');
                document.write('<div>ID: ' + post.id + '</div>');
                document.write('<div>Media Type: ' + post.media_type + '</div>');
                document.write('<div>Media URL: ' + post.media_url + '</div>');
                document.write('</li>');
            });
            document.write('</ul>');
        } else {
            document.write('<a href="' + ig.authorizationUrl + '">Authorize w/Instagram</a>');
        }
    </script>
</body>
</html>
